<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>상품 이미지를 클릭하면 팝업창을 띄우고 금액계산을 하도록 한다.</title>
<link rel="stylesheet" type="text/css" href="./css/bokStyle.css">
</head>
<body>

<div id="container">
	<div id="display"></div>
</div>

<script type="text/javascript">

	const arr_product = [
						 {productId : "led",
						  productName : "led모니터",
						  image : "monitor.jpg",
						  price : 200000,		
						  option : [
							  		{optionId:"HDMI", optionName:"HDMI케이블", price:1000},
							  		{optionId:"3Dglasses", optionName:"3D안경", price:2000}
						  			]
						 },
						 
						 {productId : "camcorder",
						  productName : "캠코더",
						  image : "cam.jpg",
						  price : 500000,
						  option : [
							  		{optionId:"3Pedestal", optionName:"3각받침대", price:10000},
							  		{optionId:"limokon", optionName:"리모콘", price:20000},
							  		{optionId:"charger", optionName:"충전기", price:30000}
						  			]
						 }						 
						];
	
	let html = `<table id='tbl'>
					<thead>
						<tr>
							<th colspan='4'>제품선택</th>
						</tr>
						<tr>
							<th width='25%'>제품사진</th>
							<th width='25%'>제품정보</th>
							<th width='30%'>부속품</th>
							<th width='20%'>주문금액</th>
						</tr>
					<thead>
					<tbody>`;
	
	arr_product.forEach(function(elt, i, array) {
		
		html += `<tr>
					<td style='text-align:center'><img src='images/${elt.image}' title='클릭하면 원본이미지가 보입니다.' /></td>
					<td>
						<ul style='list-style-type: none'>
							<li>제품명 : ${elt.productName}</li>
							<li>가격 : <span id='${elt.productId}'>${elt.price.toLocaleString('en')}</span></li>
							<li>주문수량 : <input type='number' min='0' max='20' value='0' id='${elt.productId}' /></li>
						</ul>
					</td>
					<td>`;
						elt.option.forEach(function(item, index){
							html += `<label for='${item.optionId}'>${item.optionName}</label><input type='checkbox' name='option_${elt.productId}' value='${item.price}' id='${item.optionId}' />&nbsp;`;
						});
		html += `</td>
					<td id='${elt.productId}'>0</td>
			</tr>`;
	
	});
	
	html += `</tbody>
			 <tfoot>
			 	<tr>
			 		<td colspan='3' style='text-align:center; font-size:16pt;'>주문총액</td>
			 		<td>0</td>
			 	</tr>
			 </tfoot>
		 </table>`;
	
	document.querySelector("div#display").innerHTML = html;
	
	
	// === 이미지를 클릭하면 팝업창을 띄우는 것 만들기 === //
	const openPopup = function(src) {
		
		const popupwin = window.open("","myPopup","left=100px, top=100px, width=400px, height=350px");
		
		popupwin.document.writeln("<html>");
		popupwin.document.writeln("<head><title>제품이미지 확대보기</title></head>");
		popupwin.document.writeln("<body align='center'>");
		popupwin.document.writeln("<img src='"+src+"' />");
		popupwin.document.writeln("<br/><br/><br/>");
		popupwin.document.writeln("<button type='button' onclick='window.close()'>팝업창닫기</button>");
		popupwin.document.writeln("</body>");
		popupwin.document.writeln("</html>");					
	};
	
	const img_List = document.querySelectorAll("#tbl > tbody > tr > td:nth-child(1) > img");
	
	img_List.forEach(function(elt, i, array) {
		elt.addEventListener('click', function(){
			openPopup(elt.src);
		});
	});
	// === 이미지를 클릭하면 팝업창을 띄우는 것 만들기 === //
	
	
	// === 주문수량이 바뀌면 주문금액에 값을 넣어주기, 부속품중 체크를 한 부속품에 대해서만 부속품 금액을 주문금액에 값을 넣어주기 === //
	const input_number_list = document.querySelectorAll("table#tbl input[type='number']");
	const checkbox_list = document.querySelectorAll("table#tbl input[type='checkbox']");
	
	// 주문수량 이벤트 처리하기
	input_number_list.forEach(function(elt) {
		
		elt.addEventListener('change', ()=>{
			
			const jusu = Number(elt.value);
			const price = Number(document.querySelector("table#tbl span#"+elt.id).innerText.split(",").join(""));
			const jusu_price = jusu*price;
			
			let option_price = 0;
			let total_price = 0;
			
			if(jusu == 0) {
				checkbox_list.forEach(function(item) {
					if(item.name == 'option_'+elt.id) {
						item.checked = false;
					} 
				});
			}
			else {
				checkbox_list.forEach(function(item) {
					if(item.name == 'option_'+elt.id && item.checked) {
						option_price += Number(item.value);
					} 
				});	
				total_price = jusu_price + option_price;
			}
			document.querySelector("table#tbl td#"+elt.id).innerHTML = total_price.toLocaleString('en');
			
			sumPrice();
		});
	});
	
	// 부속품 체크박스 이벤트 처리하기
	checkbox_list.forEach(function(elt) {
		
		elt.addEventListener('click', ()=>{
			
			let id = elt.name.substring(7);
			
			const jusu = Number(document.querySelector("table#tbl input[type='number']#"+id).value);
			const price = Number(document.querySelector("table#tbl span#"+id).innerText.split(",").join(""));
			const jusu_price = jusu*price;
			
			let option_price = 0;
			let total_price = 0;
			
			if(jusu == 0) {
				alert("주문수량이 0개 이므로 부속품을 선택할 수 없습니다.");
				elt.checked = false;
			}
			else {
				checkbox_list.forEach(function(item) {
					if(item.name == 'option_'+id && item.checked) {
						option_price += Number(item.value);
					}
				});
				total_price = jusu_price + option_price;
			}
			document.querySelector("table#tbl td#"+id).innerHTML = total_price.toLocaleString('en');
			
			sumPrice();
		});
	});
	
	
	// === 주문총액을 구해주는 함수 만들기 === //
	function sumPrice() {
		
		let sumPrice = 0;
		document.querySelectorAll("table#tbl > tbody > tr > td:last-child").forEach(function(elt, i, array) {
			sumPrice += Number(elt.innerText.split(",").join(""));
		});
		document.querySelector("table#tbl > tfoot > tr > td:last-child").innerHTML = sumPrice.toLocaleString('en');
	}
	
	
	// === 주문수량 keyup 이벤트 처리하기 === //
	input_number_list.forEach(function(elt, i, array){
		elt.addEventListener('keyup', ()=>{
			alert("주문수량은 마우스로만 입력하세요.");
			elt.value = 0;
		});
	});

</script>

</body>
</html>